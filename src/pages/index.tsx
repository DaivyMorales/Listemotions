import { signIn, signOut, useSession } from 'next-auth/react'
import Head from 'next/head'
import axios from 'axios'
import 'next-auth'
import { useEffect } from 'react'


export default function Home() {

  const { data: session, status } = useSession();

  // console.log(session);

  const playlistId = "5lga9js0jSBNM9TFv7UF18";

  const createPlaylist = async () => {
    if (session) {
      const playlistData = {
        "name": "REGGETONü´Å",
        "description": "Testing",
        "public": false
      }

      const headers = {
        Authorization: `Bearer ${session.accessToken}`
      }
      try {
        const response = await axios.post(`https://api.spotify.com/v1/users/${session.user.id}/playlists`, playlistData, {
          headers
        });
        console.log(response.data)
      } catch (error) {
        console.log(error)
      }
    }
  }



  return (
    <>
      <Head>
        <title>Listemotions</title>
        <meta name="description" content="Generated by create-t3-app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <h1>Home</h1>
      {
        status === "unauthenticated" ? (
          <div>
            <button onClick={() => signIn("spotify", { callbackUrl: "/generate" })}>Sign with Spotify</button>
          </div>
        ) : (
          <div>
            <button onClick={() => signOut()}>Log out</button>
            <button onClick={() => createPlaylist()}>Create a playlist</button>
          </div>
        )
      }
    </>
  )
}
